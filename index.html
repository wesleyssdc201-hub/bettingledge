<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betting Ledger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/e9c25d7677.js" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c0c0c;
            color: #E5E5E5;
        }
        .lds-dual-ring {
            display: inline-block;
            width: 20px;
            height: 20px;
        }
        .lds-dual-ring:after {
            content: " ";
            display: block;
            width: 16px;
            height: 16px;
            margin: 1px;
            border-radius: 50%;
            border: 3px solid #fff;
            border-color: #A3A3A3 transparent #A3A3A3 transparent;
            animation: lds-dual-ring 1.2s linear infinite;
        }
        @keyframes lds-dual-ring {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            border-bottom: 2px solid white;
        }
    </style>
</head>
<body class="bg-zinc-950 text-neutral-200 p-4 min-h-screen flex flex-col items-center">

<div id="auth-container" class="bg-gray-100 p-8 rounded-lg shadow-md max-w-sm mx-auto mt-20">
    <h2 class="text-2xl font-bold text-center mb-6 text-black">Betting Ledger</h2>
    <input type="email" id="email" placeholder="Email" class="w-full p-2 mb-4 border rounded-md text-black">
    <input type="password" id="password" placeholder="Senha" class="w-full p-2 mb-6 border rounded-md text-black">
    <button id="login-button" class="w-full bg-indigo-600 text-white p-2 rounded-md hover:bg-indigo-700 transition-colors mb-2">Entrar</button>
    <button id="register-button" class="w-full bg-gray-400 text-gray-800 p-2 rounded-md hover:bg-gray-500 transition-colors">Cadastrar</button>
</div>
<div class="container mx-auto p-6 bg-zinc-900 rounded-2xl shadow-lg w-full max-w-4xl" style="display: none;">
    <h1 class="text-3xl font-bold text-center mb-6 text-white">Betting Ledger</h1>

    <nav class="flex justify-center border-b border-zinc-700 mb-8">
        <button id="btn-tab-gerenciador" class="tab-button active px-4 py-2 text-white font-semibold transition-colors duration-200">
            Apostas
        </button>
        <button id="btn-tab-historico" class="tab-button px-4 py-2 text-neutral-400 font-semibold hover:text-white transition-colors duration-200">
            Histórico
        </button>
        <button id="btn-tab-freebets" class="tab-button px-4 py-2 text-neutral-400 font-semibold hover:text-white transition-colors duration-200">
            Freebets
        </button>
        <button id="btn-tab-pessoas" class="tab-button px-4 py-2 text-neutral-400 font-semibold hover:text-white transition-colors duration-200">
            Pessoas & Plataformas
        </button>
        <button id="btn-tab-ganhos" class="tab-button px-4 py-2 text-neutral-400 font-semibold hover:text-white transition-colors duration-200">
            Levantamento de Ganhos
        </button>
    </nav>

    <div id="tab-gerenciador" class="tab-content active">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-zinc-800 p-4 rounded-xl text-center shadow-inner">
                <p class="text-sm text-neutral-400">Bankroll Atual</p>
                <p id="current-bankroll" class="text-xl font-bold mt-1 text-white">R$ 0,00</p>
            </div>
            <div class="bg-zinc-800 p-4 rounded-xl text-center shadow-inner">
                <p class="text-sm text-neutral-400">Lucro/Prejuízo</p>
                <p id="profit-loss" class="text-xl font-bold mt-1 text-white">R$ 0,00</p>
            </div>
            <div class="bg-zinc-800 p-4 rounded-xl text-center shadow-inner">
                <p class="text-sm text-neutral-400">Total de Apostas</p>
                <p id="total-bets" class="text-xl font-bold mt-1 text-white">0</p>
            </div>
            <div class="bg-zinc-800 p-4 rounded-xl text-center shadow-inner">
                <p class="text-sm text-neutral-400">ROI (%)</p>
                <p id="roi" class="text-xl font-bold mt-1 text-white">0.00%</p>
            </div>
        </div>

        <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner mb-8">
            <h2 class="text-xl font-bold mb-4 text-white" id="bet-form-title">Adicionar Nova Aposta</h2>
            <form id="bet-form" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                    <label for="date" class="block text-sm font-medium text-neutral-300">Data</label>
                    <input type="date" id="date" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                </div>
                <div>
                    <label for="description" class="block text-sm font-medium text-neutral-300">Evento / Descrição</label>
                    <input type="text" id="description" placeholder="Ex: Jogo de futebol" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                </div>
                <div>
                    <label for="person" class="block text-sm font-medium text-neutral-300">Pessoa</label>
                    <select id="person" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                        <option value="">Selecione a Pessoa</option>
                    </select>
                </div>
                <div>
                    <label for="platform" class="block text-sm font-medium text-neutral-300">Plataforma</label>
                    <select id="platform" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required disabled>
                        <option value="">Selecione a Plataforma</option>
                    </select>
                </div>
                <div>
                    <label for="type" class="block text-sm font-medium text-neutral-300">Tipo</label>
                    <select id="type" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50">
                        <option value="Normal">Normal</option>
                        <option value="Missao">Missão</option>
                        <option value="Bonus">Bônus</option>
                        <option value="Freebet">Freebet</option>
                    </select>
                </div>
                <div>
                    <label for="stake" class="block text-sm font-medium text-neutral-300">Valor Apostado (R$)</label>
                    <input type="number" step="0.001" id="stake" placeholder="0.00" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                </div>
                <div>
                    <label for="odds" class="block text-sm font-medium text-neutral-300">Odds</label>
                    <input type="number" step="0.001" id="odds" placeholder="Ex: 2.50" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                </div>
                <div>
                    <label for="result" class="block text-sm font-medium text-neutral-300">Resultado</label>
                    <select id="result" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50">
                        <option value="">Selecione</option>
                        <option value="Green">Green (Ganhou)</option>
                        <option value="Half Green">Meio Green</option>
                        <option value="Red">Red (Perdeu)</option>
                        <option value="Half Red">Meio Red</option>
                        <option value="Void">Void (Anulada)</option>
                        <option value="Aberta">Aberta (Não finalizada)</option>
                        <option value="Aberta FB">Aberta FB (não finalizado)</option>
                        <option value="Red FB">Red FB (Perdeu)</option>
                    </select>
                </div>
                <div class="sm:col-span-2 lg:col-span-4 flex justify-center mt-4">
                    <button type="submit" id="bet-form-button" class="w-full sm:w-auto px-6 py-2 bg-neutral-800 text-white rounded-md shadow-lg hover:bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-600 transition duration-300">
                        Adicionar Aposta
                    </button>
                </div>
            </form>
        </div>

        <div id="message-box" class="hidden p-4 rounded-md mb-4 text-center text-sm"></div>

        <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner overflow-x-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-white">Apostas Abertas</h2>
                <button id="clear-bet-data-btn" class="px-4 py-2 text-sm bg-neutral-800 text-white rounded-md hover:bg-neutral-700 transition duration-300">
                    Limpar Todos os Dados
                </button>
            </div>
            <table class="min-w-full divide-y divide-zinc-700">
                <thead class="bg-zinc-900">
                <tr>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Data</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Descrição</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Pessoa</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Plataforma</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Tipo</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Valor Apostado</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Odds</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Resultado</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Retorno</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Lucro</th>
                    <th class="px-4 py-2 whitespace-nowrap text-sm font-medium text-neutral-400 uppercase tracking-wider w-1/4">Ações</th>
                </tr>
                </thead>
                <tbody id="bets-table-body" class="bg-zinc-900 divide-y divide-zinc-800">
                </tbody>
            </table>
        </div>
    </div>

    <div id="tab-historico" class="tab-content">
        <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner overflow-x-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-white">Histórico de Apostas Finalizadas</h2>
            </div>
            <table class="min-w-full divide-y divide-zinc-700">
                <thead class="bg-zinc-900">
                <tr>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Data</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Descrição</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Pessoa</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Plataforma</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Tipo</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Valor Apostado</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Odds</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Resultado</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Retorno</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Lucro</th>
                    <th class="px-4 py-2 whitespace-nowrap text-sm font-medium text-neutral-400 uppercase tracking-wider">Ações</th>
                </tr>
                </thead>
                <tbody id="history-table-body" class="bg-zinc-900 divide-y divide-zinc-800">
                </tbody>
            </table>
        </div>
    </div>

    <div id="tab-freebets" class="tab-content">
        <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner mb-8">
            <h2 class="text-xl font-bold mb-4 text-white">Adicionar Freebet</h2>
            <form id="freebet-form" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                    <label for="freebet-person" class="block text-sm font-medium text-neutral-300">Pessoa</label>
                    <select id="freebet-person" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                        <option value="">Selecione a Pessoa</option>
                    </select>
                </div>
                <div>
                    <label for="freebet-platform" class="block text-sm font-medium text-neutral-300">Plataforma</label>
                    <select id="freebet-platform" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required disabled>
                        <option value="">Selecione a Plataforma</option>
                    </select>
                </div>
                <div>
                    <label for="freebet-stake" class="block text-sm font-medium text-neutral-300">Valor (R$)</label>
                    <input type="number" step="0.01" id="freebet-stake" placeholder="0.00" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                </div>
                <div>
                    <label for="freebet-quantity" class="block text-sm font-medium text-neutral-300">Quantidade</label>
                    <input type="number" id="freebet-quantity" value="1" min="1" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                </div>
                <div>
                    <label for="freebet-received" class="block text-sm font-medium text-neutral-300">Recebida?</label>
                    <select id="freebet-received" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                        <option value="sim">Sim</option>
                        <option value="nao">Não</option>
                    </select>
                </div>
                <div>
                    <label for="freebet-expiration" class="block text-sm font-medium text-neutral-300">Data de Vencimento</label>
                    <input type="date" id="freebet-expiration" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50">
                </div>
                <div class="sm:col-span-2 lg:col-span-4 flex justify-center mt-4">
                    <button type="submit" class="w-full sm:w-auto px-6 py-2 bg-neutral-800 text-white rounded-md shadow-lg hover:bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-600 transition duration-300">
                        Adicionar Freebet
                    </button>
                </div>
            </form>
        </div>

        <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner overflow-x-auto">
            <h2 class="text-xl font-bold mb-4 text-white">Freebets Não Utilizadas</h2>
            <table class="min-w-full divide-y divide-zinc-700">
                <thead class="bg-zinc-900">
                <tr>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Pessoa</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Plataforma</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Valor</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Recebida?</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Vencimento</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Ações</th>
                </tr>
                </thead>
                <tbody id="freebets-table-body" class="bg-zinc-900 divide-y divide-zinc-800">
                </tbody>
            </table>
        </div>
    </div>

    <div id="tab-pessoas" class="tab-content">
        <div id="people-list-view">
            <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner mb-8">
                <h2 class="text-xl font-bold mb-4 text-white">Adicionar Nova Pessoa</h2>
                <form id="person-form" class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="person-name" placeholder="Nome da Pessoa" class="flex-1 rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                    <button type="submit" class="px-6 py-2 bg-neutral-800 text-white rounded-md shadow-lg hover:bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-600 transition duration-300">
                        Adicionar Pessoa
                    </button>
                </form>
            </div>

            <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner overflow-x-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">Pessoas Cadastradas</h2>
                    <button id="clear-people-btn" class="px-4 py-2 text-sm bg-neutral-800 text-white rounded-md hover:bg-neutral-700 transition duration-300">
                        Limpar Pessoas
                    </button>
                </div>
                <table class="min-w-full divide-y divide-zinc-700">
                    <thead class="bg-zinc-900">
                    <tr>
                        <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Pessoa</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Saldo Total</th>
                        <th class="px-4 py-2 text-right text-xs font-medium text-neutral-400 uppercase tracking-wider w-1/5">Ações</th>
                    </tr>
                    </thead>
                    <tbody id="people-table-body" class="bg-zinc-900 divide-y divide-zinc-800">
                    </tbody>
                </table>
            </div>
        </div>

        <div id="platforms-management-view" class="hidden">
            <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner mb-8">
                <button id="back-to-people-btn" class="px-4 py-2 text-sm bg-neutral-800 text-white rounded-md hover:bg-neutral-700 transition duration-300 mb-4">
                    ← Voltar para Pessoas
                </button>
                <h2 class="text-xl font-bold mb-4 text-white" id="current-person-name"></h2>

                <div class="bg-zinc-700 p-4 rounded-xl shadow-inner mb-6">
                    <h3 class="text-lg font-semibold mb-2 text-neutral-200">Adicionar Nova Plataforma</h3>
                    <form id="platform-form" class="flex flex-col sm:flex-row gap-4">
                        <input type="text" id="platform-name" placeholder="Nome da Plataforma" class="flex-1 rounded-md border-zinc-600 bg-zinc-800 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                        <button type="submit" class="px-6 py-2 bg-neutral-800 text-white rounded-md shadow-lg hover:bg-neutral-700">
                            Adicionar
                        </button>
                    </form>
                </div>

                <div class="overflow-x-auto">
                    <h3 class="text-lg font-semibold mb-2 text-neutral-200">Plataformas</h3>
                    <table class="min-w-full divide-y divide-zinc-700">
                        <thead class="bg-zinc-800">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Plataforma</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Saldo</th>
                            <th class="px-4 py-2 text-right text-xs font-medium text-neutral-400 uppercase tracking-wider w-1/4">Ações</th>
                        </tr>
                        </thead>
                        <tbody id="platforms-table-body" class="bg-zinc-900 divide-y divide-zinc-800">
                        </tbody>
                    </table>
                </div>

                <div id="transaction-form-container" class="hidden bg-zinc-700 p-4 rounded-xl shadow-inner mt-6">
                    <h3 class="text-lg font-bold mb-2 text-white" id="transaction-title">Ajustar Saldo</h3>
                    <div class="mb-4 text-sm text-neutral-300">Saldo Atual: <span id="current-platform-balance" class="font-bold"></span></div>
                    <div class="mb-2 text-sm text-neutral-300">Plataforma: <span id="platform-name-display" class="font-bold text-neutral-200"></span></div>
                    <form id="transaction-form">
                        <div class="mb-4">
                            <label for="transaction-amount" class="block text-sm font-medium text-neutral-300">Valor (R$)</label>
                            <input type="number" step="0.01" id="transaction-amount" placeholder="0.00" class="mt-1 block w-full rounded-md border-zinc-600 bg-zinc-800 text-neutral-200 p-2 shadow-sm" required>
                        </div>
                        <input type="hidden" id="current-platform-id">
                        <div class="flex gap-4 justify-end">
                            <button type="submit" id="btn-add-balance" class="bg-gray-700 text-xs hover:bg-gray-600 transition-colors duration-200 px-2 py-1 rounded-lg font-medium shadow-md flex items-center gap-1">
                                <i class="fa-solid fa-plus text-green-400"></i> Adicionar Saldo
                            </button>
                            <button type="submit" id="btn-withdraw-balance" class="bg-gray-700 text-xs hover:bg-gray-600 transition-colors duration-200 px-2 py-1 rounded-lg font-medium shadow-md flex items-center gap-1">
                                <i class="fa-solid fa-minus text-red-400"></i> Retirar Saldo
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-ganhos" class="tab-content">
        <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner mb-8">
            <h2 class="text-xl font-bold mb-4 text-white text-center">Levantamento de Ganhos</h2>
            <div id="profit-analysis-container" class="space-y-6">
                <div id="daily-profits-section">
                    <h3 class="text-lg font-semibold text-neutral-200 mb-2">Ganhos Diários</h3>
                    <ul id="daily-list" class="space-y-2"></ul>
                </div>
                <div id="monthly-profits-section">
                    <h3 class="text-lg font-semibold text-neutral-200 mb-2">Ganhos Mensais</h3>
                    <ul id="monthly-list" class="space-y-2"></ul>
                </div>
                <div id="annual-profits-section">
                    <h3 class="text-lg font-semibold text-neutral-200 mb-2">Ganhos Anuais</h3>
                    <ul id="annual-list" class="space-y-2"></ul>
                </div>
            </div>
            <p id="no-profit-data" class="text-neutral-400 text-sm text-center mt-4 hidden">Nenhum dado de aposta para exibir.</p>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    
    // Variáveis globais para os objetos do Firebase
    let db;
    let auth;

    // Elementos da UI
    const authContainer = document.getElementById('auth-container');
    const mainContent = document.querySelector('.container.mx-auto');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginButton = document.getElementById('login-button');
    const registerButton = document.getElementById('register-button');
    const signOutButton = document.getElementById('sign-out-btn');
    const betsTableBody = document.getElementById('bets-table-body');
    const historyTableBody = document.getElementById('history-table-body');
    const betsTabBtn = document.querySelector('#btn-tab-gerenciador');
    const historyTabBtn = document.querySelector('#btn-tab-historico');
    const freebetsTabBtn = document.querySelector('#btn-tab-freebets');
    const peopleTabBtn = document.querySelector('#btn-tab-pessoas');
    const withdrawalsTabBtn = document.querySelector('#btn-tab-ganhos');

    // Funções de Utilitário
    const formatCurrency = (amount) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(amount);

    // Funções para renderização (agora sem duplicações)
    const renderBets = (betsToRender) => {
        betsTableBody.innerHTML = '';
        betsToRender.forEach(bet => {
            const resultColorClass = bet.result === 'Green' ? 'text-green-500' : bet.result === 'Red' ? 'text-red-500' : 'text-neutral-400';
            const profitColorClass = bet.profit > 0 ? 'text-green-500' : bet.profit < 0 ? 'text-red-500' : 'text-neutral-400';
            const row = document.createElement('tr');
            row.className = 'border-b border-zinc-700 hover:bg-zinc-700';
            row.innerHTML = `
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.date}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.description}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.personName}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.platformName}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.type}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${formatCurrency(bet.stake)}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.odds}</td>
                <td class="px-4 py-2 text-sm font-semibold ${resultColorClass}">${bet.result}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${formatCurrency(bet.return)}</td>
                <td class="px-4 py-2 text-sm font-semibold ${profitColorClass}">${formatCurrency(bet.profit)}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm font-medium">
                    <button class="edit-bet-btn bg-neutral-800 text-white px-2 py-1 rounded-md text-xs hover:bg-neutral-700 transition duration-300" data-id="${bet.id}">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button class="delete-bet-btn bg-red-500 text-white px-2 py-1 rounded-md text-xs hover:bg-red-600 transition duration-300 ml-2" data-id="${bet.id}">
                        <i class="fas fa-trash-alt"></i> Deletar
                    </button>
                </td>
            `;
            betsTableBody.appendChild(row);
        });
    };

    const renderHistory = (historyToRender) => {
        historyTableBody.innerHTML = '';
        historyToRender.forEach(bet => {
            const resultColorClass = bet.result === 'Green' ? 'text-green-500' : bet.result === 'Red' ? 'text-red-500' : 'text-neutral-400';
            const profitColorClass = bet.profit > 0 ? 'text-green-500' : bet.profit < 0 ? 'text-red-500' : 'text-neutral-400';
            const row = document.createElement('tr');
            row.className = 'border-b border-zinc-700 hover:bg-zinc-700';
            row.innerHTML = `
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.date}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.description}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.personName}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.platformName}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.type}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${formatCurrency(bet.stake)}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${bet.odds}</td>
                <td class="px-4 py-2 text-sm font-semibold ${resultColorClass}">${bet.result}</td>
                <td class="px-4 py-2 text-sm text-neutral-400">${formatCurrency(bet.return)}</td>
                <td class="px-4 py-2 text-sm font-semibold ${profitColorClass}">${formatCurrency(bet.profit)}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm font-medium">
                    <button class="edit-bet-btn bg-neutral-800 text-white px-2 py-1 rounded-md text-xs hover:bg-neutral-700 transition duration-300" data-id="${bet.id}">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button class="delete-bet-btn bg-red-500 text-white px-2 py-1 rounded-md text-xs hover:bg-red-600 transition duration-300 ml-2" data-id="${bet.id}">
                        <i class="fas fa-trash-alt"></i> Deletar
                    </button>
                </td>
            `;
            historyTableBody.appendChild(row);
        });
    };

    // Variáveis Globais de Dados
    let people = [];
    let bets = [];
    let freebets = [];
    let currentPersonId = null;

    // Funções de Carregamento de Dados
    const loadBets = async () => {
        if (!auth.currentUser) return;
        const querySnapshot = await getDocs(collection(db, `users/${auth.currentUser.uid}/bets`));
        bets = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        const openBets = bets.filter(bet => bet.result === 'Aberta' || bet.result === 'Aberta FB');
        const finishedBets = bets.filter(bet => bet.result !== 'Aberta' && bet.result !== 'Aberta FB');
        renderBets(openBets);
        renderHistory(finishedBets);
        updateAll();
    };

    const loadPeople = async () => {
        if (!auth.currentUser) return;
        const querySnapshot = await getDocs(collection(db, `users/${auth.currentUser.uid}/people`));
        people = await Promise.all(querySnapshot.docs.map(async doc => {
            const platformsSnapshot = await getDocs(collection(db, `users/${auth.currentUser.uid}/people/${doc.id}/platforms`));
            const platforms = platformsSnapshot.docs.map(platDoc => ({ id: platDoc.id, ...platDoc.data() }));
            const totalBalance = platforms.reduce((sum, p) => sum + (p.balance || 0), 0);
            return { id: doc.id, ...doc.data(), platforms, totalBalance };
        }));
    };

    const loadFreebets = async () => {
        if (!auth.currentUser) return;
        const querySnapshot = await getDocs(collection(db, `users/${auth.currentUser.uid}/freebets`));
        freebets = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    };

    const updateBankroll = () => {
        const totalBankroll = people.reduce((sum, p) => sum + (p.totalBalance || 0), 0);
        document.getElementById('current-bankroll').textContent = formatCurrency(totalBankroll);
    };

    const updateProfitLoss = () => {
        const totalProfitLoss = bets.reduce((sum, bet) => sum + (bet.profit || 0), 0);
        const profitLossElement = document.getElementById('profit-loss');
        if (totalProfitLoss >= 0) {
            profitLossElement.textContent = `+${formatCurrency(totalProfitLoss)}`;
            profitLossElement.classList.remove('text-red-500');
            profitLossElement.classList.add('text-green-500');
        } else {
            profitLossElement.textContent = formatCurrency(totalProfitLoss);
            profitLossElement.classList.remove('text-green-500');
            profitLossElement.classList.add('text-red-500');
        }
    };
    
    const updateAll = () => {
        updateBankroll();
        updateProfitLoss();
    };

    // Listener para as tabs
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-white');
                btn.classList.add('text-neutral-400');
            });
            button.classList.add('active', 'text-white');
            button.classList.remove('text-neutral-400');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            const targetId = button.id.replace('btn-tab-', 'tab-');
            document.getElementById(targetId).style.display = 'block';
        });
    });

    // Função para inicializar o Firebase e adicionar os event listeners de login
    async function initializeAndSetupApp() {
        try {
            const response = await fetch('/api/config.js');
            if (!response.ok) {
                throw new Error('Erro ao carregar a configuração do Firebase.');
            }
            const firebaseConfig = await response.json();
            
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            // Este listener DEVE estar aqui, após o 'auth' ser inicializado
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    authContainer.style.display = 'none';
                    mainContent.style.display = 'block';
                    signOutButton.style.display = 'block';
                    loadBets();
                    loadPeople();
                    loadFreebets();
                    updateAll();
                } else {
                    authContainer.style.display = 'block';
                    mainContent.style.display = 'none';
                    signOutButton.style.display = 'none';
                }
            });

            // Adiciona os listeners APÓS a inicialização do Firebase
            registerButton.addEventListener('click', () => {
                const email = emailInput.value;
                const password = passwordInput.value;
                createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        alert('Cadastro realizado com sucesso! Pode entrar.');
                    })
                    .catch((error) => {
                        alert('Erro ao cadastrar: ' + error.message);
                    });
            });

            loginButton.addEventListener('click', () => {
                const email = emailInput.value;
                const password = passwordInput.value;
                signInWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        alert('Login realizado com sucesso!');
                    })
                    .catch((error) => {
                        alert('Erro ao fazer login: ' + error.message);
                    });
            });
            
            signOutButton.addEventListener('click', () => {
                signOut(auth).then(() => {
                    alert('Você saiu da sua conta.');
                }).catch((error) => {
                    alert('Erro ao sair: ' + error.message);
                });
            });

        } catch (error) {
            console.error("Erro ao carregar a configuração do Firebase:", error);
            alert("Erro ao carregar a aplicação. Por favor, tente novamente mais tarde.");
        }
    }

    // Chama a função principal para iniciar tudo
    initializeAndSetupApp();

</script>
</body>
</html>