<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betting Ledger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif';
            background-color: #0c0c0c;
            color: #E5E5E5;
        }
        .lds-dual-ring {
            display: inline-block;
            width: 20px;
            height: 20px;
        }
        .lds-dual-ring:after {
            content: " ";
            display: block;
            width: 16px;
            height: 16px;
            margin: 1px;
            border-radius: 50%;
            border: 3px solid #fff;
            border-color: #A3A3A3 transparent #A3A3A3 transparent;
            animation: lds-dual-ring 1.2s linear infinite;
        }
        @keyframes lds-dual-ring {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            border-bottom: 2px solid white;
        }
    </style>
</head>
<body class="bg-zinc-950 text-neutral-200 p-4 min-h-screen flex flex-col items-center">

<div id="auth-container" class="bg-gray-100 p-8 rounded-lg shadow-md max-w-sm mx-auto mt-20">
    <h2 class="text-2xl font-bold text-center mb-6">Betting Ledger</h2>
    <input type="email" id="email" placeholder="Email" class="w-full p-2 mb-4 border rounded-md">
    <input type="password" id="password" placeholder="Senha" class="w-full p-2 mb-6 border rounded-md">
    <button id="login-button" class="w-full bg-indigo-600 text-white p-2 rounded-md hover:bg-indigo-700 transition-colors mb-2">Entrar</button>
    <button id="register-button" class="w-full bg-gray-400 text-gray-800 p-2 rounded-md hover:bg-gray-500 transition-colors">Cadastrar</button>
</div>
    <div class="container mx-auto p-6 bg-zinc-900 rounded-2xl shadow-lg w-full max-w-4xl" style="display: none;">
        <h1 class="text-3xl font-bold text-center mb-6 text-white">Betting Ledger</h1>
        
        <nav class="flex justify-center border-b border-zinc-700 mb-8">
            <button id="btn-tab-gerenciador" class="tab-button active px-4 py-2 text-white font-semibold transition-colors duration-200">
                Apostas
            </button>
            <button id="btn-tab-historico" class="tab-button px-4 py-2 text-neutral-400 font-semibold hover:text-white transition-colors duration-200">
                Histórico
            </button>
            <button id="btn-tab-freebets" class="tab-button px-4 py-2 text-neutral-400 font-semibold hover:text-white transition-colors duration-200">
                Freebets
            </button>
            <button id="btn-tab-pessoas" class="tab-button px-4 py-2 text-neutral-400 font-semibold hover:text-white transition-colors duration-200">
                Pessoas & Plataformas
            </button>
            <button id="btn-tab-ganhos" class="tab-button px-4 py-2 text-neutral-400 font-semibold hover:text-white transition-colors duration-200">
                Levantamento de Ganhos
            </button>
        </nav>

        <div id="tab-gerenciador" class="tab-content active">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-zinc-800 p-4 rounded-xl text-center shadow-inner">
                    <p class="text-sm text-neutral-400">Bankroll Atual</p>
                    <p id="current-bankroll" class="text-xl font-bold mt-1 text-white">R$ 0,00</p>
                </div>
                <div class="bg-zinc-800 p-4 rounded-xl text-center shadow-inner">
                    <p class="text-sm text-neutral-400">Lucro/Prejuízo</p>
                    <p id="profit-loss" class="text-xl font-bold mt-1 text-white">R$ 0,00</p>
                </div>
                <div class="bg-zinc-800 p-4 rounded-xl text-center shadow-inner">
                    <p class="text-sm text-neutral-400">Total de Apostas</p>
                    <p id="total-bets" class="text-xl font-bold mt-1 text-white">0</p>
                </div>
                <div class="bg-zinc-800 p-4 rounded-xl text-center shadow-inner">
                    <p class="text-sm text-neutral-400">ROI (%)</p>
                    <p id="roi" class="text-xl font-bold mt-1 text-white">0.00%</p>
                </div>
            </div>

            <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner mb-8">
                <h2 class="text-xl font-bold mb-4 text-white" id="bet-form-title">Adicionar Nova Aposta</h2>
                <form id="bet-form" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label for="date" class="block text-sm font-medium text-neutral-300">Data</label>
                        <input type="date" id="date" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                    </div>
                    <div>
                        <label for="description" class="block text-sm font-medium text-neutral-300">Evento / Descrição</label>
                        <input type="text" id="description" placeholder="Ex: Jogo de futebol" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                    </div>
                    <div>
                        <label for="person" class="block text-sm font-medium text-neutral-300">Pessoa</label>
                        <select id="person" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                            <option value="">Selecione a Pessoa</option>
                        </select>
                    </div>
                    <div>
                        <label for="platform" class="block text-sm font-medium text-neutral-300">Plataforma</label>
                        <select id="platform" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required disabled>
                            <option value="">Selecione a Plataforma</option>
                        </select>
                    </div>
                    <div>
                        <label for="type" class="block text-sm font-medium text-neutral-300">Tipo</label>
                        <select id="type" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50">
                            <option value="Normal">Normal</option>
                            <option value="Missao">Missão</option>
                            <option value="Bonus">Bônus</option>
                            <option value="Freebet">Freebet</option>
                        </select>
                    </div>
                    <div>
                        <label for="stake" class="block text-sm font-medium text-neutral-300">Valor Apostado (R$)</label>
                        <input type="number" step="0.001" id="stake" placeholder="0.00" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity50" required>
                    </div>
                    <div>
                        <label for="odds" class="block text-sm font-medium text-neutral-300">Odds</label>
                        <input type="number" step="0.001" id="odds" placeholder="Ex: 2.50" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                    </div>
                    <div>
                        <label for="result" class="block text-sm font-medium text-neutral-300">Resultado</label>
                        <select id="result" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50">
                            <option value="">Selecione</option>
                            <option value="Green">Green (Ganhou)</option>
                            <option value="Half Green">Meio Green</option>
                            <option value="Red">Red (Perdeu)</option>
                            <option value="Half Red">Meio Red</option>
                            <option value="Void">Void (Anulada)</option>
                            <option value="Aberta">Aberta (Não finalizada)</option>
                            <option value="Aberta FB">Aberta FB (não finalizado)</option>
                            <option value="Red FB">Red FB (Perdeu)</option>
                        </select>
                    </div>
                    <div class="sm:col-span-2 lg:col-span-4 flex justify-center mt-4">
                        <button type="submit" id="bet-form-button" class="w-full sm:w-auto px-6 py-2 bg-neutral-800 text-white rounded-md shadow-lg hover:bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-600 transition duration-300">
                            Adicionar Aposta
                        </button>
                    </div>
                </form>
            </div>
            
            <div id="message-box" class="hidden p-4 rounded-md mb-4 text-center text-sm"></div>

            <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner overflow-x-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">Apostas Abertas</h2>
                    <button id="clear-bet-data-btn" class="px-4 py-2 text-sm bg-neutral-800 text-white rounded-md hover:bg-neutral-700 transition duration-300">
                        Limpar Todos os Dados
                    </button>
                </div>
                <table class="min-w-full divide-y divide-zinc-700">
                    <thead class="bg-zinc-900">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Data</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Descrição</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Pessoa</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Plataforma</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Tipo</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Valor Apostado</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Odds</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Resultado</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Retorno</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Lucro</th>
                            <th class="px-4 py-2 whitespace-nowrap text-sm font-medium text-neutral-400 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="bets-table-body" class="bg-zinc-900 divide-y divide-zinc-800">
                        </tbody>
                </table>
            </div>
        </div>
        
        <div id="tab-historico" class="tab-content">
             <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner overflow-x-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">Histórico de Apostas Finalizadas</h2>
                </div>
                <table class="min-w-full divide-y divide-zinc-700">
                    <thead class="bg-zinc-900">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Data</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Descrição</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Pessoa</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Plataforma</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Tipo</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Valor Apostado</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Odds</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Resultado</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Retorno</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Lucro</th>
                            <th class="px-4 py-2 whitespace-nowrap text-sm font-medium text-neutral-400 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body" class="bg-zinc-900 divide-y divide-zinc-800">
                        </tbody>
                </table>
            </div>
        </div>
        
        <div id="tab-freebets" class="tab-content">
            <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner mb-8">
                <h2 class="text-xl font-bold mb-4 text-white">Adicionar Freebet</h2>
                <form id="freebet-form" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label for="freebet-person" class="block text-sm font-medium text-neutral-300">Pessoa</label>
                        <select id="freebet-person" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                            <option value="">Selecione a Pessoa</option>
                        </select>
                    </div>
                    <div>
                        <label for="freebet-platform" class="block text-sm font-medium text-neutral-300">Plataforma</label>
                        <select id="freebet-platform" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required disabled>
                            <option value="">Selecione a Plataforma</option>
                        </select>
                    </div>
                    <div>
                        <label for="freebet-stake" class="block text-sm font-medium text-neutral-300">Valor (R$)</label>
                        <input type="number" step="0.01" id="freebet-stake" placeholder="0.00" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                    </div>
                    <div>
                        <label for="freebet-quantity" class="block text-sm font-medium text-neutral-300">Quantidade</label>
                        <input type="number" id="freebet-quantity" value="1" min="1" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                    </div>
                    <div>
                        <label for="freebet-received" class="block text-sm font-medium text-neutral-300">Recebida?</label>
                        <select id="freebet-received" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                    <div>
                        <label for="freebet-expiration" class="block text-sm font-medium text-neutral-300">Data de Vencimento</label>
                        <input type="date" id="freebet-expiration" class="mt-1 block w-full rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50">
                    </div>
                    <div class="sm:col-span-2 lg:col-span-4 flex justify-center mt-4">
                        <button type="submit" class="w-full sm:w-auto px-6 py-2 bg-neutral-800 text-white rounded-md shadow-lg hover:bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-600 transition duration-300">
                            Adicionar Freebet
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner overflow-x-auto">
                <h2 class="text-xl font-bold mb-4 text-white">Freebets Não Utilizadas</h2>
                <table class="min-w-full divide-y divide-zinc-700">
                    <thead class="bg-zinc-900">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Pessoa</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Plataforma</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Valor</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Recebida?</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Vencimento</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="freebets-table-body" class="bg-zinc-900 divide-y divide-zinc-800">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="tab-pessoas" class="tab-content">
            <div id="people-list-view">
                <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner mb-8">
                    <h2 class="text-xl font-bold mb-4 text-white">Adicionar Nova Pessoa</h2>
                    <form id="person-form" class="flex flex-col sm:flex-row gap-4">
                        <input type="text" id="person-name" placeholder="Nome da Pessoa" class="flex-1 rounded-md border-zinc-700 bg-zinc-900 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                        <button type="submit" class="px-6 py-2 bg-neutral-800 text-white rounded-md shadow-lg hover:bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-600 transition duration-300">
                            Adicionar Pessoa
                        </button>
                    </form>
                </div>
                
                <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner overflow-x-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-white">Pessoas Cadastradas</h2>
                        <button id="clear-people-btn" class="px-4 py-2 text-sm bg-neutral-800 text-white rounded-md hover:bg-neutral-700 transition duration-300">
                            Limpar Pessoas
                        </button>
                    </div>
                    <table class="min-w-full divide-y divide-zinc-700">
                        <thead class="bg-zinc-900">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Pessoa</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Saldo Total</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="people-table-body" class="bg-zinc-900 divide-y divide-zinc-800">
                            <tr class="hover:bg-zinc-800 transition-colors duration-200">
                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-neutral-200">Exemplo</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-neutral-400">R$ 0,00</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                                    <div class="flex items-center gap-2">
                                        <button onclick="managePlatforms('exemplo')" class="px-3 py-1 bg-neutral-700 text-white rounded hover:bg-neutral-600 transition-colors duration-200" title="Gerenciar Plataformas">Gerenciar</button>
                                        <button onclick="adjustBalance('exemplo')" class="px-3 py-1 bg-neutral-700 text-white rounded hover:bg-neutral-600 transition-colors duration-200" title="Ajustar Saldo">Ajustar Saldo</button>
                                        <button onclick="deletePerson('exemplo')" class="p-1 bg-red-700 text-white rounded-full hover:bg-red-600 transition-colors duration-200" title="Deletar Pessoa">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="platforms-management-view" class="hidden">
                <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner mb-8">
                    <button id="back-to-people-btn" class="px-4 py-2 text-sm bg-neutral-800 text-white rounded-md hover:bg-neutral-700 transition duration-300 mb-4">
                        ← Voltar para Pessoas
                    </button>
                    <h2 class="text-xl font-bold mb-4 text-white" id="current-person-name"></h2>
                    
                    <div class="bg-zinc-700 p-4 rounded-xl shadow-inner mb-6">
                        <h3 class="text-lg font-semibold mb-2 text-neutral-200">Adicionar Nova Plataforma</h3>
                        <form id="platform-form" class="flex flex-col sm:flex-row gap-4">
                            <input type="text" id="platform-name" placeholder="Nome da Plataforma" class="flex-1 rounded-md border-zinc-600 bg-zinc-800 text-neutral-200 p-2 shadow-sm focus:border-white focus:ring focus:ring-neutral-400 focus:ring-opacity-50" required>
                            <button type="submit" class="px-6 py-2 bg-neutral-800 text-white rounded-md shadow-lg hover:bg-neutral-700">
                                Adicionar
                            </button>
                        </form>
                    </div>

                    <div class="overflow-x-auto">
                        <h3 class="text-lg font-semibold mb-2 text-neutral-200">Plataformas</h3>
                        <table class="min-w-full divide-y divide-zinc-700">
                            <thead class="bg-zinc-800">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Plataforma</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Saldo</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-neutral-400 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="platforms-table-body" class="bg-zinc-900 divide-y divide-zinc-800">
                                </tbody>
                        </table>
                    </div>
                    
                    <div id="transaction-form-container" class="hidden bg-zinc-700 p-4 rounded-xl shadow-inner mt-6">
                        <h3 class="text-lg font-bold mb-2 text-white" id="transaction-title">Ajustar Saldo</h3>
                        <div class="mb-4 text-sm text-neutral-300">Saldo Atual: <span id="current-platform-balance" class="font-bold"></span></div>
                        <form id="transaction-form">
                            <div class="mb-4">
                                <label for="transaction-amount" class="block text-sm font-medium text-neutral-300">Valor (R$)</label>
                                <input type="number" step="0.01" id="transaction-amount" placeholder="0.00" class="mt-1 block w-full rounded-md border-zinc-600 bg-zinc-800 text-neutral-200 p-2 shadow-sm" required>
                            </div>
                            <input type="hidden" id="current-platform-id">
                            <div class="flex gap-4 justify-end">
                                <button type="submit" id="btn-add-balance" class="px-6 py-2 bg-neutral-800 text-white rounded-md shadow-lg hover:bg-neutral-700 transition duration-300">
                                    Adicionar Saldo
                                </button>
                                <button type="submit" id="btn-withdraw-balance" class="px-6 py-2 bg-red-800 text-white rounded-md shadow-lg hover:bg-red-700 transition duration-300">
                                    Retirar Saldo
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="tab-ganhos" class="tab-content">
            <div class="bg-zinc-800 p-6 rounded-2xl shadow-inner mb-8">
                <h2 class="text-xl font-bold mb-4 text-white text-center">Levantamento de Ganhos</h2>
                <div id="profit-analysis-container" class="space-y-6">
                    <div id="daily-profits-section">
                        <h3 class="text-lg font-semibold text-neutral-200 mb-2">Ganhos Diários</h3>
                        <ul id="daily-list" class="space-y-2"></ul>
                    </div>
                    <div id="monthly-profits-section">
                        <h3 class="text-lg font-semibold text-neutral-200 mb-2">Ganhos Mensais</h3>
                        <ul id="monthly-list" class="space-y-2"></ul>
                    </div>
                    <div id="annual-profits-section">
                        <h3 class="text-lg font-semibold text-neutral-200 mb-2">Ganhos Anuais</h3>
                        <ul id="annual-list" class="space-y-2"></ul>
                    </div>
                </div>
                <p id="no-profit-data" class="text-neutral-400 text-sm text-center mt-4 hidden">Nenhum dado de aposta para exibir.</p>
            </div>
        </div>
    </div>

    <script type="module">
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script>
    // Configuração pública do Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCCA2C8c4HFx7VY6s7bh_a5n_f3O2Ogm7Y",
        authDomain: "betting-ledger-558f2.firebaseapp.com",
        projectId: "betting-ledger-558f2",
        storageBucket: "betting-ledger-558f2.firebasestorage.app",
        messagingSenderId: "68773956884",
        appId: "1:68773956884:web:1bd90aba9cefede5c88601"
    };

    // Inicialize o Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Referências do DOM (Login e Cadastro)
    const authContainer = document.getElementById('auth-container');
    const mainContent = document.getElementById('main-content');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginButton = document.getElementById('login-button');

    const registerModal = document.getElementById('register-modal');
    const showRegisterModalButton = document.getElementById('show-register-modal');
    const closeRegisterModalButton = document.getElementById('close-register-modal');
    const registerButton = document.getElementById('register-button');
    const registerEmailInput = document.getElementById('register-email');
    const registerPasswordInput = document.getElementById('register-password');

    // Estado de Autenticação
    auth.onAuthStateChanged((user) => {
        if (user) {
            console.log("Usuário logado:", user.email);
            authContainer.style.display = 'none';
            mainContent.style.display = 'block';
            loadBets();
            loadPeople();
            loadFreebets();
            updateAll();
        } else {
            authContainer.style.display = 'block';
            mainContent.style.display = 'none';
            console.log("Nenhum usuário logado.");
        }
    });

    // Eventos para o Modal de Cadastro
    showRegisterModalButton.addEventListener('click', (event) => {
        event.preventDefault();
        registerModal.style.display = 'flex';
    });

    closeRegisterModalButton.addEventListener('click', () => {
        registerModal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
        if (event.target === registerModal) {
            registerModal.style.display = 'none';
        }
    });

    // Eventos dos Botões de Login e Cadastro (agora com a requisição para a API)
    registerButton.addEventListener('click', () => {
        const email = registerEmailInput.value;
        const password = registerPasswordInput.value;
        firebase.auth().createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                alert('Cadastro realizado com sucesso! Pode entrar.');
                registerModal.style.display = 'none';
            })
            .catch((error) => {
                alert('Erro ao cadastrar: ' + error.message);
            });
    });

    loginButton.addEventListener('click', async () => {
        const email = emailInput.value;
        const password = passwordInput.value;
        
        try {
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, password }),
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message);
            }

            const { customToken } = await response.json();
            
            // Entra no sistema usando o token seguro
            await firebase.auth().signInWithCustomToken(customToken);

            alert('Login realizado com sucesso!');
        } catch (error) {
            alert('Erro ao fazer login: ' + error.message);
        }
    });

    // Variáveis globais (da sua planilha)
    let bets = [];
    let people = [];
    let unusedFreebets = [];
    let currentPersonId = null;
    let isEditingBetIndex = -1;
    
    // Chaves para o localStorage
    const LOCAL_STORAGE_BETS_KEY = 'bankrollBets';
    const LOCAL_STORAGE_PEOPLE_KEY = 'bankrollPeople';
    const LOCAL_STORAGE_FREEBETS_KEY = 'unusedFreebets';

    // Elementos do DOM (Abas)
    const btnTabGerenciador = document.getElementById('btn-tab-gerenciador');
    const btnTabHistorico = document.getElementById('btn-tab-historico');
    const btnTabFreebets = document.getElementById('btn-tab-freebets');
    const btnTabPessoas = document.getElementById('btn-tab-pessoas');
    const btnTabGanhos = document.getElementById('btn-tab-ganhos');
    const tabGerenciador = document.getElementById('tab-gerenciador');
    const tabHistorico = document.getElementById('tab-historico');
    const tabFreebets = document.getElementById('tab-freebets');
    const tabPessoas = document.getElementById('tab-pessoas');
    const tabGanhos = document.getElementById('tab-ganhos');

    // Elementos do DOM (Aba Apostas)
    const form = document.getElementById('bet-form');
    const formTitle = document.getElementById('bet-form-title');
    const formButton = document.getElementById('bet-form-button');
    const dateInput = document.getElementById('date');
    const descriptionInput = document.getElementById('description');
    const personSelect = document.getElementById('person');
    const platformSelect = document.getElementById('platform');
    const typeSelect = document.getElementById('type');
    const stakeInput = document.getElementById('stake');
    const oddsInput = document.getElementById('odds');
    const resultSelect = document.getElementById('result');
    const betsTableBody = document.getElementById('bets-table-body');
    const currentBankrollDisplay = document.getElementById('current-bankroll');
    const profitLossDisplay = document.getElementById('profit-loss');
    const totalBetsDisplay = document.getElementById('total-bets');
    const roiDisplay = document.getElementById('roi');
    const messageBox = document.getElementById('message-box');
    const clearBetDataBtn = document.getElementById('clear-bet-data-btn');

    // Elementos do DOM (Aba Histórico)
    const historyTableBody = document.getElementById('history-table-body');

    // Elementos do DOM (Aba Freebets)
    const freebetForm = document.getElementById('freebet-form');
    const freebetPersonSelect = document.getElementById('freebet-person');
    const freebetPlatformSelect = document.getElementById('freebet-platform');
    const freebetStakeInput = document.getElementById('freebet-stake');
    const freebetQuantityInput = document.getElementById('freebet-quantity');
    const freebetReceivedSelect = document.getElementById('freebet-received');
    const freebetExpirationInput = document.getElementById('freebet-expiration');
    const freebetsTableBody = document.getElementById('freebets-table-body');

    // Elementos do DOM (Aba Pessoas)
    const peopleListView = document.getElementById('people-list-view');
    const platformsManagementView = document.getElementById('platforms-management-view');
    const personForm = document.getElementById('person-form');
    const peopleTableBody = document.getElementById('people-table-body');
    const clearPeopleBtn = document.getElementById('clear-people-btn');
    const backToPeopleBtn = document.getElementById('back-to-people-btn');
    const currentPersonName = document.getElementById('current-person-name');
    const platformForm = document.getElementById('platform-form');
    const platformsTableBody = document.getElementById('platforms-table-body');
    const transactionFormContainer = document.getElementById('transaction-form-container');
    const transactionForm = document.getElementById('transaction-form');
    const transactionAmountInput = document.getElementById('transaction-amount');
    const currentPlatformIdInput = document.getElementById('current-platform-id');
    const currentPlatformBalanceDisplay = document.getElementById('current-platform-balance');

    // Elementos do DOM (Aba Ganhos)
    const dailyList = document.getElementById('daily-list');
    const monthlyList = document.getElementById('monthly-list');
    const annualList = document.getElementById('annual-list');
    const noProfitDataMsg = document.getElementById('no-profit-data');

    // Funções de Utilitários
    const formatCurrency = (value) => {
        return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
    };

    const showMessage = (message, type) => {
        messageBox.textContent = message;
        messageBox.style.backgroundColor = type === 'green' ? '#262626' : '#262626';
        messageBox.style.color = type === 'green' ? '#E5E5E5' : '#A3A3A3';
        messageBox.classList.remove('hidden');
        setTimeout(() => {
            messageBox.classList.add('hidden');
        }, 3000);
    };

    const resetForm = () => {
        form.reset();
        isEditingBetIndex = -1;
        formTitle.textContent = 'Adicionar Nova Aposta';
        formButton.textContent = 'Adicionar Aposta';
        resultSelect.value = "";
        stakeInput.classList.remove('text-red-400');
        oddsInput.classList.remove('text-red-400');
        descriptionInput.focus();
    };

        const populatePersonSelect = () => {
            const selects = [personSelect, freebetPersonSelect];
            selects.forEach(select => {
                select.innerHTML = '<option value="">Selecione a Pessoa</option>';
                people.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.id;
                    option.textContent = p.name;
                    select.appendChild(option);
                });
            });
            platformSelect.disabled = true;
            platformSelect.innerHTML = '<option value="">Selecione a Plataforma</option>';
            freebetPlatformSelect.disabled = true;
            freebetPlatformSelect.innerHTML = '<option value="">Selecione a Plataforma</option>';
        };

        const populatePlatformSelect = (personId, targetSelect, selectedPlatformName = '') => {
            targetSelect.innerHTML = '<option value="">Selecione a Plataforma</option>';
            const selectedPerson = people.find(p => p.id === personId);
            if (selectedPerson) {
                targetSelect.disabled = false;
                selectedPerson.platforms.forEach(plat => {
                    const option = document.createElement('option');
                    option.value = plat.id;
                    option.textContent = plat.name;
                    targetSelect.appendChild(option);
                });
                if (selectedPlatformName) {
                    const platformOption = Array.from(targetSelect.options).find(opt => opt.textContent === selectedPlatformName);
                    if (platformOption) {
                        targetSelect.value = platformOption.value;
                    }
                }
            } else {
                targetSelect.disabled = true;
            }
        };

        personSelect.addEventListener('change', (e) => {
            populatePlatformSelect(e.target.value, platformSelect);
        });

        freebetPersonSelect.addEventListener('change', (e) => {
            populatePlatformSelect(e.target.value, freebetPlatformSelect);
        });

        // --- Lógica das Abas ---
        const switchTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active', 'text-white'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.add('text-neutral-400'));
            document.getElementById(tabId).classList.add('active');
            if (tabId === 'tab-gerenciador') {
                btnTabGerenciador.classList.add('active', 'text-white');
                renderOpenBets();
                renderSummary();
            } else if (tabId === 'tab-historico') {
                btnTabHistorico.classList.add('active', 'text-white');
                renderHistoryBets();
                renderSummary();
            } else if (tabId === 'tab-freebets') {
                btnTabFreebets.classList.add('active', 'text-white');
                renderUnusedFreebets();
            } else if (tabId === 'tab-pessoas') {
                btnTabPessoas.classList.add('active', 'text-white');
                renderPeople();
            } else if (tabId === 'tab-ganhos') {
                btnTabGanhos.classList.add('active', 'text-white');
                renderProfitAnalysis();
            }
        };

        btnTabGerenciador.addEventListener('click', () => switchTab('tab-gerenciador'));
        btnTabHistorico.addEventListener('click', () => switchTab('tab-historico'));
        btnTabFreebets.addEventListener('click', () => switchTab('tab-freebets'));
        btnTabPessoas.addEventListener('click', () => switchTab('tab-pessoas'));
        btnTabGanhos.addEventListener('click', () => switchTab('tab-ganhos'));

        // --- Lógica da Aba Apostas e Histórico ---
        const saveBets = () => {
            localStorage.setItem(LOCAL_STORAGE_BETS_KEY, JSON.stringify(bets));
        };

        const loadBets = () => {
            const savedBets = localStorage.getItem(LOCAL_STORAGE_BETS_KEY);
            if (savedBets) {
                bets = JSON.parse(savedBets);
            }
        };

        const calculateReturn = (stake, odds, result) => {
            if (result === 'Green') return stake * odds;
            if (result === 'Half Green') return (stake * (odds - 1) / 2) + stake;
            if (result === 'Void') return stake;
            if (result === 'Half Red') return stake / 2;
            if (result === 'Aberta' || result === 'Aberta FB' || result === 'Red FB') return 0;
            return 0; // Red
        };

        const calculateProfit = (retorno, stake, tipo, result) => {
            if (result === 'Aberta' || result === 'Aberta FB' || result === 'Red FB') return 0;
            if (tipo === 'Freebet') return retorno - stake;
            return retorno - stake;
        };

        const renderSummary = () => {
            let totalProfit = 0;
            let totalStaked = 0;
            bets.forEach(bet => {
                if (bet.result !== 'Aberta' && bet.result !== 'Aberta FB' && bet.result !== 'Red FB') {
                    const retorno = calculateReturn(bet.stake, bet.odds, bet.result);
                    const lucro = calculateProfit(retorno, bet.stake, bet.type, bet.result);
                    totalProfit += lucro;
                } else if (bet.result === 'Red FB') {
                    const lucro = calculateProfit(0, bet.stake, bet.type, bet.result);
                    totalProfit += lucro;
                }
                if (bet.result !== 'Aberta FB' && bet.result !== 'Red FB' ) {
                    totalStaked += bet.stake;
                }
            });
            let totalBankroll = 0;
            people.forEach(person => {
                person.platforms.forEach(platform => {
                    totalBankroll += getPlatformBalance(platform);
                });
            });

            const finalBankroll = totalBankroll;
            currentBankrollDisplay.textContent = formatCurrency(finalBankroll);
            currentBankrollDisplay.style.color = finalBankroll >= 0 ? '#E5E5E5' : '#A3A3A3';

            profitLossDisplay.textContent = formatCurrency(totalProfit);
            profitLossDisplay.style.color = totalProfit >= 0 ? '#E5E5E5' : '#A3A3A3';

            totalBetsDisplay.textContent = bets.length;

            const roi = totalStaked > 0 ? (totalProfit / totalStaked) * 100 : 0;
            roiDisplay.textContent = `${roi.toFixed(2)}%`;
            roiDisplay.style.color = roi >= 0 ? '#E5E5E5' : '#A3A3A3';
        };

        const createBetRow = (bet, index, tableBody) => {
            const row = document.createElement('tr');
            row.classList.add('hover:bg-zinc-800', 'transition-colors', 'duration-200');

            const retorno = calculateReturn(bet.stake, bet.odds, bet.result);
            const lucro = calculateProfit(retorno, bet.stake, bet.type, bet.result);

            const actionsHtml = `
                <button onclick="editBet(${index})" class="text-neutral-400 hover:text-white transition-colors duration-200" title="Editar">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                </button>
                <button onclick="deleteBet(${index})" class="text-red-400 hover:text-red-300 transition-colors duration-200" title="Deletar">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </button>
                <button onclick="duplicateBet(${index})" class="text-neutral-400 hover:text-white transition-colors duration-200" title="Duplicar">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v-3m8 4v-3m-9 8h-3m-4 16v-3m-4 16v-3m15-4v-3m8 4v-3M3 12h-3m16 4h-3M3 8h-3m16 4h-3M19 12h-3M3 16h-3m16 4h-3M8 12h3M12 12v3M12 12h-3" />
                    </svg>
                </button>
            `;
            
            row.innerHTML = `
                <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${bet.date}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${bet.description}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${bet.personName}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${bet.platformName}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${bet.type}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${formatCurrency(bet.stake)}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${bet.odds}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm font-semibold ${bet.result === 'Green' ? 'text-green-500' : bet.result.includes('Half') ? 'text-yellow-500' : bet.result.includes('Red') ? 'text-red-500' : 'text-neutral-400'}">${bet.result}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${formatCurrency(retorno)}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm font-bold ${lucro >= 0 ? 'text-green-500' : 'text-red-500'}">${formatCurrency(lucro)}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm font-medium">
                    <div class="flex items-center space-x-2">
                        <button onclick="editBet(${index})" class="text-neutral-400 hover:text-white transition-colors duration-200" title="Editar">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                        </button>
                        <button onclick="deleteBet(${index})" class="text-red-400 hover:text-red-300 transition-colors duration-200" title="Deletar">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                        <button onclick="duplicateBet(${index})" class="text-neutral-400 hover:text-white transition-colors duration-200" title="Duplicar">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v-3m8 4v-3m-9 8h-3m-4 16v-3m-4 16v-3m15-4v-3m8 4v-3M3 12h-3m16 4h-3M3 8h-3m16 4h-3M19 12h-3M3 16h-3m16 4h-3M8 12h3M12 12v3M12 12h-3" />
                            </svg>
                        </button>
                    </div>
                </td>
            `;

            tableBody.appendChild(row);
        };

        const renderOpenBets = () => {
            betsTableBody.innerHTML = '';
            bets.forEach((bet, index) => {
                if (bet.result === 'Aberta' || bet.result === 'Aberta FB' || bet.result === 'Red FB') {
                    createBetRow(bet, index, betsTableBody);
                }
            });
        };

        const renderHistoryBets = () => {
            historyTableBody.innerHTML = '';
            bets.forEach((bet, index) => {
                if (bet.result !== 'Aberta' && bet.result !== 'Aberta FB' && bet.result !== 'Red FB') {
                    createBetRow(bet, index, historyTableBody);
                }
            });
        };

        const addBet = async (betData) => {
            try {
                // Adiciona a aposta ao Firebase
                const docRef = await addDoc(collection(db, "bets"), { ...betData, userId: auth.currentUser.uid });
                betData.id = docRef.id;

                // Encontra a pessoa e a plataforma para atualizar o saldo
                const person = people.find(p => p.id === betData.personId);
                const platform = person.platforms.find(p => p.id === betData.platformId);

                // Deduz o valor da aposta do saldo da plataforma, exceto para Freebet
                if (betData.type !== 'Freebet') {
                    platform.balance -= betData.stake;
                }

                // Salva a aposta e atualiza os saldos no localStorage
                bets.unshift(betData);
                saveBets();
                savePeople();
                renderSummary();
                renderOpenBets();

                // Atualiza o documento no Firestore com o novo saldo
                await updateDoc(doc(db, "people", person.id), {
                    platforms: person.platforms
                });
                showMessage('Aposta adicionada com sucesso!', 'green');

            } catch (error) {
                console.error("Erro ao adicionar aposta: ", error);
                showMessage('Erro ao adicionar aposta. Tente novamente.', 'red');
            }
        };

        const updateBet = async (index, betData) => {
            const oldBet = bets[index];
            const oldPerson = people.find(p => p.id === oldBet.personId);
            const oldPlatform = oldPerson.platforms.find(p => p.id === oldBet.platformId);

            // Reverte a alteração do saldo da aposta antiga
            if (oldBet.type !== 'Freebet' && oldBet.result !== 'Aberta' && oldBet.result !== 'Aberta FB' && oldBet.result !== 'Red FB') {
                const oldProfit = calculateProfit(calculateReturn(oldBet.stake, oldBet.odds, oldBet.result), oldBet.stake, oldBet.type, oldBet.result);
                oldPlatform.balance -= oldProfit;
            } else if (oldBet.result === 'Red FB') {
                oldPlatform.balance -= calculateProfit(0, oldBet.stake, oldBet.type, oldBet.result);
            }
            if (oldBet.type !== 'Freebet' && (oldBet.result === 'Aberta' || oldBet.result === 'Aberta FB' || oldBet.result === 'Red FB')) {
                oldPlatform.balance += oldBet.stake;
            }


            // Aplica a nova alteração no saldo
            const newPerson = people.find(p => p.id === betData.personId);
            const newPlatform = newPerson.platforms.find(p => p.id === betData.platformId);
            
            if (betData.result !== 'Aberta' && betData.result !== 'Aberta FB' && betData.result !== 'Red FB') {
                const newProfit = calculateProfit(calculateReturn(betData.stake, betData.odds, betData.result), betData.stake, betData.type, betData.result);
                newPlatform.balance += newProfit;
            } else if (betData.result === 'Red FB') {
                newPlatform.balance += calculateProfit(0, betData.stake, betData.type, betData.result);
            }
            if (betData.type !== 'Freebet' && (betData.result === 'Aberta' || betData.result === 'Aberta FB' || betData.result === 'Red FB')) {
                newPlatform.balance -= betData.stake;
            }

            // Atualiza a aposta na lista e no Firebase
            bets[index] = betData;
            saveBets();
            savePeople();
            renderSummary();
            switchTab('tab-historico');
            
            try {
                // Atualiza o documento no Firestore
                await updateDoc(doc(db, "bets", betData.id), betData);
                await updateDoc(doc(db, "people", oldPerson.id), {
                    platforms: oldPerson.platforms
                });
                if (oldPerson.id !== newPerson.id) {
                    await updateDoc(doc(db, "people", newPerson.id), {
                        platforms: newPerson.platforms
                    });
                }
                showMessage('Aposta atualizada com sucesso!', 'green');
            } catch (error) {
                console.error("Erro ao atualizar aposta: ", error);
                showMessage('Erro ao atualizar aposta. Tente novamente.', 'red');
            }
        };

        window.editBet = (index) => {
            const betToEdit = bets[index];
            dateInput.value = betToEdit.date;
            descriptionInput.value = betToEdit.description;
            personSelect.value = betToEdit.personId;
            populatePlatformSelect(betToEdit.personId, platformSelect, betToEdit.platformName);
            typeSelect.value = betToEdit.type;
            stakeInput.value = betToEdit.stake;
            oddsInput.value = betToEdit.odds;
            resultSelect.value = betToEdit.result;
            formTitle.textContent = 'Editar Aposta';
            formButton.textContent = 'Atualizar Aposta';
            isEditingBetIndex = index;
            // Volta para a aba de apostas
            switchTab('tab-gerenciador');
        };

        window.deleteBet = async (index) => {
            if (!confirm('Tem certeza que deseja deletar esta aposta?')) {
                return;
            }
            const betToDelete = bets[index];
            const person = people.find(p => p.id === betToDelete.personId);
            const platform = person.platforms.find(p => p.id === betToDelete.platformId);

            if (betToDelete.result !== 'Aberta' && betToDelete.result !== 'Aberta FB' && betToDelete.result !== 'Red FB') {
                const profit = calculateProfit(calculateReturn(betToDelete.stake, betToDelete.odds, betToDelete.result), betToDelete.stake, betToDelete.type, betToDelete.result);
                platform.balance -= profit;
            } else if (betToDelete.result === 'Red FB') {
                platform.balance -= calculateProfit(0, betToDelete.stake, betToDelete.type, betToDelete.result);
            }
            if (betToDelete.type !== 'Freebet' && (betToDelete.result === 'Aberta' || betToDelete.result === 'Aberta FB' || betToDelete.result === 'Red FB')) {
                platform.balance += betToDelete.stake;
            }

            bets.splice(index, 1);
            saveBets();
            savePeople();
            renderSummary();
            renderOpenBets();
            renderHistoryBets();
            
            try {
                await deleteDoc(doc(db, "bets", betToDelete.id));
                await updateDoc(doc(db, "people", person.id), { platforms: person.platforms });
                showMessage('Aposta deletada com sucesso!', 'green');
            } catch (error) {
                console.error("Erro ao deletar aposta: ", error);
                showMessage('Erro ao deletar aposta. Tente novamente.', 'red');
            }
        };

        window.duplicateBet = (index) => {
            const betToDuplicate = bets[index];
            dateInput.value = betToDuplicate.date;
            descriptionInput.value = betToDuplicate.description;
            personSelect.value = betToDuplicate.personId;
            populatePlatformSelect(betToDuplicate.personId, platformSelect, betToDuplicate.platformName);
            typeSelect.value = betToDuplicate.type;
            stakeInput.value = betToDuplicate.stake;
            oddsInput.value = betToDuplicate.odds;
            resultSelect.value = betToDuplicate.result;
            formTitle.textContent = 'Adicionar Nova Aposta';
            formButton.textContent = 'Adicionar Aposta';
            isEditingBetIndex = -1;
            switchTab('tab-gerenciador');
        };

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const betData = {
                date: dateInput.value,
                description: descriptionInput.value,
                personId: personSelect.value,
                personName: personSelect.options[personSelect.selectedIndex].textContent,
                platformId: platformSelect.value,
                platformName: platformSelect.options[platformSelect.selectedIndex].textContent,
                type: typeSelect.value,
                stake: parseFloat(stakeInput.value),
                odds: parseFloat(oddsInput.value),
                result: resultSelect.value,
                timestamp: Date.now()
            };

            if (isEditingBetIndex !== -1) {
                betData.id = bets[isEditingBetIndex].id;
                await updateBet(isEditingBetIndex, betData);
            } else {
                await addBet(betData);
            }
            resetForm();
        });

        // --- Lógica da Aba Pessoas ---
        const savePeople = () => {
            localStorage.setItem(LOCAL_STORAGE_PEOPLE_KEY, JSON.stringify(people));
        };

        const loadPeople = () => {
            const savedPeople = localStorage.getItem(LOCAL_STORAGE_PEOPLE_KEY);
            if (savedPeople) {
                people = JSON.parse(savedPeople);
            }
        };

        const renderPeople = () => {
            peopleTableBody.innerHTML = '';
            people.forEach((person, index) => {
                const totalBalance = person.platforms.reduce((sum, plat) => sum + getPlatformBalance(plat), 0);
                const actionsHtml = `
                    <div class="flex items-center gap-2">
                        <button onclick="managePlatforms('${person.id}')" class="px-3 py-1 bg-neutral-700 text-white rounded hover:bg-neutral-600 transition-colors duration-200" title="Gerenciar Plataformas">Gerenciar</button>
                        <button onclick="deletePerson('${person.id}')" class="p-1 bg-red-700 text-white rounded-full hover:bg-red-600 transition-colors duration-200" title="Deletar Pessoa">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                `;
                const row = document.createElement('tr');
                row.classList.add('hover:bg-zinc-800', 'transition-colors', 'duration-200');
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-neutral-200">${person.name}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-neutral-400">${formatCurrency(totalBalance)}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">${actionsHtml}</td>
                `;
                peopleTableBody.appendChild(row);
            });
        };

        const addPerson = async (personName) => {
            const newPerson = {
                id: Date.now().toString(),
                name: personName,
                platforms: []
            };
            people.push(newPerson);
            savePeople();
            populatePersonSelect();
            renderPeople();
            try {
                await addDoc(collection(db, "people"), { ...newPerson, userId: auth.currentUser.uid });
                showMessage('Pessoa adicionada com sucesso!', 'green');
            } catch (error) {
                console.error("Erro ao adicionar pessoa: ", error);
                showMessage('Erro ao adicionar pessoa. Tente novamente.', 'red');
            }
        };

        window.deletePerson = async (personId) => {
            if (!confirm('Deletar esta pessoa irá remover todas as plataformas e apostas associadas. Tem certeza?')) {
                return;
            }
            people = people.filter(p => p.id !== personId);
            bets = bets.filter(b => b.personId !== personId);
            unusedFreebets = unusedFreebets.filter(fb => fb.personId !== personId);

            savePeople();
            saveBets();
            saveFreebets();
            
            populatePersonSelect();
            renderPeople();
            renderSummary();
            switchTab('tab-gerenciador');
            
            try {
                await deleteDoc(doc(db, "people", personId));
                // Nota: As apostas e freebets associadas devem ser deletadas com uma função de nuvem.
                showMessage('Pessoa e dados associados deletados com sucesso!', 'green');
            } catch (error) {
                console.error("Erro ao deletar pessoa: ", error);
                showMessage('Erro ao deletar pessoa. Tente novamente.', 'red');
            }
        };
        
        personForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const personName = document.getElementById('person-name').value;
            if (personName) {
                addPerson(personName);
                document.getElementById('person-name').value = '';
            }
        });

        clearPeopleBtn.addEventListener('click', async () => {
            if (confirm('Tem certeza que deseja limpar todos os dados de Pessoas e Plataformas? Isso irá remover todos os saldos e plataformas!')) {
                people = [];
                bets = [];
                unusedFreebets = [];
                savePeople();
                saveBets();
                saveFreebets();
                populatePersonSelect();
                renderPeople();
                renderSummary();
                switchTab('tab-gerenciador');
                
                try {
                    const querySnapshot = await getDocs(collection(db, "people"));
                    querySnapshot.forEach(async (d) => {
                        await deleteDoc(doc(db, "people", d.id));
                    });
                    const betsSnapshot = await getDocs(collection(db, "bets"));
                    betsSnapshot.forEach(async (d) => {
                        await deleteDoc(doc(db, "bets", d.id));
                    });
                    const freebetsSnapshot = await getDocs(collection(db, "freebets"));
                    freebetsSnapshot.forEach(async (d) => {
                        await deleteDoc(doc(db, "freebets", d.id));
                    });
                    showMessage('Todos os dados de pessoas e plataformas foram limpos.', 'green');
                } catch (error) {
                console.error("Erro ao limpar dados: ", error);
                showMessage('Erro ao limpar dados. Tente novamente.', 'red');
            }
            }
        });
        
        window.managePlatforms = (personId) => {
            currentPersonId = personId;
            const person = people.find(p => p.id === personId);
            if (person) {
                currentPersonName.textContent = person.name;
                peopleListView.classList.add('hidden');
                platformsManagementView.classList.remove('hidden');
                renderPlatforms();
            }
        };

        backToPeopleBtn.addEventListener('click', () => {
            peopleListView.classList.remove('hidden');
            platformsManagementView.classList.add('hidden');
            currentPersonId = null;
            transactionFormContainer.classList.add('hidden');
        });

        // --- Lógica da Aba Plataformas ---
        const getPlatformBalance = (platform) => {
            return platform.balance || 0;
        };

        const renderPlatforms = () => {
            const person = people.find(p => p.id === currentPersonId);
            if (!person) return;
            platformsTableBody.innerHTML = '';
            person.platforms.forEach((platform, index) => {
                const actionsHtml = `
                    <div class="flex items-center gap-2">
                        <button onclick="editPlatform('${platform.id}')" class="text-neutral-400 hover:text-white transition-colors duration-200" title="Editar">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                        </button>
                        <button onclick="deletePlatform('${platform.id}')" class="text-red-400 hover:text-red-300 transition-colors duration-200" title="Deletar">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                        <button onclick="adjustPlatformBalance('${platform.id}')" class="px-3 py-1 bg-neutral-700 text-white rounded hover:bg-neutral-600 transition-colors duration-200" title="Ajustar Saldo">
                            Ajustar Saldo
                        </button>
                    </div>
                `;
                const row = document.createElement('tr');
                row.classList.add('hover:bg-zinc-800', 'transition-colors', 'duration-200');
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-neutral-200">${platform.name}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-neutral-400">${formatCurrency(getPlatformBalance(platform))}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">${actionsHtml}</td>
                `;
                platformsTableBody.appendChild(row);
            });
        };
        
        window.adjustPlatformBalance = (platformId) => {
            const person = people.find(p => p.id === currentPersonId);
            const platform = person.platforms.find(p => p.id === platformId);
            if (platform) {
                currentPlatformBalanceDisplay.textContent = formatCurrency(platform.balance);
                currentPlatformIdInput.value = platformId;
                transactionFormContainer.classList.remove('hidden');
                transactionAmountInput.focus();
            }
        };

        platformForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const platformName = document.getElementById('platform-name').value;
            const person = people.find(p => p.id === currentPersonId);
            if (person && platformName) {
                const newPlatform = {
                    id: Date.now().toString(),
                    name: platformName,
                    balance: 0
                };
                person.platforms.push(newPlatform);
                savePeople();
                renderPlatforms();
                renderSummary();
                
                try {
                    await updateDoc(doc(db, "people", person.id), { platforms: person.platforms });
                    showMessage('Plataforma adicionada com sucesso!', 'green');
                } catch (error) {
                    console.error("Erro ao adicionar plataforma: ", error);
                    showMessage('Erro ao adicionar plataforma. Tente novamente.', 'red');
                }
            }
            document.getElementById('platform-name').value = '';
        });

        window.deletePlatform = async (platformId) => {
            if (!confirm('Tem certeza que deseja deletar esta plataforma?')) {
                return;
            }
            const person = people.find(p => p.id === currentPersonId);
            if (person) {
                person.platforms = person.platforms.filter(p => p.id !== platformId);
                savePeople();
                renderPlatforms();
                renderSummary();
                
                try {
                    await updateDoc(doc(db, "people", person.id), { platforms: person.platforms });
                    showMessage('Plataforma deletada com sucesso!', 'green');
                } catch (error) {
                    console.error("Erro ao deletar plataforma: ", error);
                    showMessage('Erro ao deletar plataforma. Tente novamente.', 'red');
                }
            }
        };

        window.editPlatform = (platformId) => {
            const person = people.find(p => p.id === currentPersonId);
            const platform = person.platforms.find(p => p.id === platformId);
            if (platform) {
                const newName = prompt("Insira o novo nome para a plataforma:", platform.name);
                if (newName && newName !== platform.name) {
                    platform.name = newName;
                    savePeople();
                    renderPlatforms();
                    renderSummary();
                }
            }
        };

        transactionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const amount = parseFloat(transactionAmountInput.value.replace(',', '.')); // Garante que o valor é um número válido
            const platformId = currentPlatformIdInput.value;
            const person = people.find(p => p.id === currentPersonId);
            const platform = person.platforms.find(p => p.id === platformId);

            if (isNaN(amount) || !platform) {
                showMessage('Valor inválido ou plataforma não encontrada.', 'red');
                return;
            }

            if (e.submitter.id === 'btn-add-balance') {
                platform.balance += amount;
            } else if (e.submitter.id === 'btn-withdraw-balance') {
                platform.balance -= amount;
            }

            savePeople();
            renderPlatforms();
            renderSummary();
            transactionFormContainer.classList.add('hidden');
            
            try {
                await updateDoc(doc(db, "people", person.id), { platforms: person.platforms });
                showMessage('Saldo da plataforma ajustado com sucesso!', 'green');
                transactionAmountInput.value = ''; // Limpa o campo após o sucesso
            } catch (error) {
                console.error("Erro ao ajustar saldo: ", error);
                showMessage('Erro ao ajustar saldo. Tente novamente.', 'red');
            }
        });

        // --- Lógica da Aba Freebets ---
        const saveFreebets = () => {
            localStorage.setItem(LOCAL_STORAGE_FREEBETS_KEY, JSON.stringify(unusedFreebets));
        };

        const loadFreebets = () => {
            const savedFreebets = localStorage.getItem(LOCAL_STORAGE_FREEBETS_KEY);
            if (savedFreebets) {
                unusedFreebets = JSON.parse(savedFreebets);
            }
        };
        
        const renderUnusedFreebets = () => {
            freebetsTableBody.innerHTML = '';
            unusedFreebets.forEach((fb, index) => {
                const actionsHtml = `
                    <div class="flex items-center space-x-2">
                        <button onclick="useFreebet(${index})" class="px-2 py-1 bg-green-700 text-white rounded-md hover:bg-green-600 transition-colors duration-200">
                            Usar
                        </button>
                        <button onclick="deleteFreebet(${index})" class="p-1 bg-red-700 text-white rounded-full hover:bg-red-600 transition-colors duration-200" title="Deletar">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                `;
                const row = document.createElement('tr');
                row.classList.add('hover:bg-zinc-800', 'transition-colors', 'duration-200');
                row.innerHTML = `
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${fb.personName}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${fb.platformName}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${formatCurrency(fb.stake)}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${fb.received === 'sim' ? 'Sim' : 'Não'}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-neutral-400">${fb.expiration || 'N/A'}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm font-medium">${actionsHtml}</td>
                `;
                freebetsTableBody.appendChild(row);
            });
        };

        freebetForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const personId = freebetPersonSelect.value;
            const personName = freebetPersonSelect.options[freebetPersonSelect.selectedIndex].textContent;
            const platformId = freebetPlatformSelect.value;
            const platformName = freebetPlatformSelect.options[freebetPlatformSelect.selectedIndex].textContent;
            const stake = parseFloat(freebetStakeInput.value);
            const quantity = parseInt(freebetQuantityInput.value);
            const received = freebetReceivedSelect.value;
            const expiration = freebetExpirationInput.value;

            for (let i = 0; i < quantity; i++) {
                const newFreebet = {
                    personId,
                    personName,
                    platformId,
                    platformName,
                    stake,
                    received,
                    expiration,
                    id: Date.now().toString() + '-' + i,
                    timestamp: Date.now()
                };
                unusedFreebets.push(newFreebet);
            }
            saveFreebets();
            renderUnusedFreebets();
            freebetForm.reset();
            
            try {
                // Adiciona a freebet ao Firebase
                const docRef = await addDoc(collection(db, "freebets"), { personId, personName, platformId, platformName, stake, quantity, received, expiration, userId: auth.currentUser.uid });
                showMessage('Freebet(s) adicionada(s) com sucesso!', 'green');
            } catch (error) {
                console.error("Erro ao adicionar freebet: ", error);
                showMessage('Erro ao adicionar freebet. Tente novamente.', 'red');
            }
        });

        window.useFreebet = (index) => {
            const freebetToUse = unusedFreebets[index];
            dateInput.value = new Date().toISOString().slice(0, 10);
            descriptionInput.value = 'Freebet - ' + freebetToUse.platformName;
            personSelect.value = freebetToUse.personId;
            populatePlatformSelect(freebetToUse.personId, platformSelect, freebetToUse.platformName);
            typeSelect.value = 'Freebet';
            stakeInput.value = freebetToUse.stake;
            oddsInput.value = '';
            resultSelect.value = 'Aberta FB';
            
            // Remove a freebet da lista
            unusedFreebets.splice(index, 1);
            saveFreebets();
            renderUnusedFreebets();
            switchTab('tab-gerenciador');
            
            try {
                deleteDoc(doc(db, "freebets", freebetToUse.id));
                showMessage('Freebet movida para o formulário. Não se esqueça de preencher as odds e o resultado!', 'green');
            } catch (error) {
                console.error("Erro ao usar freebet: ", error);
                showMessage('Erro ao usar freebet. Tente novamente.', 'red');
            }
        };

        window.deleteFreebet = async (index) => {
            if (!confirm('Tem certeza que deseja deletar esta freebet?')) {
                return;
            }
            const freebetToDelete = unusedFreebets[index];
            unusedFreebets.splice(index, 1);
            saveFreebets();
            renderUnusedFreebets();
            
            try {
                await deleteDoc(doc(db, "freebets", freebetToDelete.id));
                showMessage('Freebet deletada com sucesso!', 'green');
            } catch (error) {
                console.error("Erro ao deletar freebet: ", error);
                showMessage('Erro ao deletar freebet. Tente novamente.', 'red');
            }
        };

        // --- Lógica da Aba Ganhos ---
        const renderProfitAnalysis = () => {
            const dailyProfits = {};
            const monthlyProfits = {};
            const annualProfits = {};
            
            bets.forEach(bet => {
                if (bet.result !== 'Aberta' && bet.result !== 'Aberta FB' && bet.result !== 'Red FB') {
                    const retorno = calculateReturn(bet.stake, bet.odds, bet.result);
                    const lucro = calculateProfit(retorno, bet.stake, bet.type, bet.result);
                    const date = new Date(bet.date + 'T12:00:00.000Z');
                    
                    // Ganhos Diários
                    const dayKey = date.toISOString().split('T')[0];
                    if (!dailyProfits[dayKey]) dailyProfits[dayKey] = 0;
                    dailyProfits[dayKey] += lucro;
                    
                    // Ganhos Mensais
                    const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    if (!monthlyProfits[monthKey]) monthlyProfits[monthKey] = 0;
                    monthlyProfits[monthKey] += lucro;
                    
                    // Ganhos Anuais
                    const yearKey = date.getFullYear();
                    if (!annualProfits[yearKey]) annualProfits[yearKey] = 0;
                    annualProfits[yearKey] += lucro;
                } else if (bet.result === 'Red FB') {
                    const lucro = calculateProfit(0, bet.stake, bet.type, bet.result);
                    const date = new Date(bet.date + 'T12:00:00.000Z');
                    
                    const dayKey = date.toISOString().split('T')[0];
                    if (!dailyProfits[dayKey]) dailyProfits[dayKey] = 0;
                    dailyProfits[dayKey] += lucro;
                    
                    const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    if (!monthlyProfits[monthKey]) monthlyProfits[monthKey] = 0;
                    monthlyProfits[monthKey] += lucro;
                    
                    const yearKey = date.getFullYear();
                    if (!annualProfits[yearKey]) annualProfits[yearKey] = 0;
                    annualProfits[yearKey] += lucro;
                }
            });
            
            // Renderiza listas
            const renderList = (listElement, profits) => {
                listElement.innerHTML = '';
                if (Object.keys(profits).length === 0) {
                    return false;
                }
                const sortedKeys = Object.keys(profits).sort().reverse();
                sortedKeys.forEach(key => {
                    const li = document.createElement('li');
                    li.classList.add('flex', 'justify-between', 'items-center', 'p-3', 'bg-zinc-700', 'rounded-lg', 'shadow-sm', 'hover:bg-zinc-600', 'transition-colors');
                    li.innerHTML = `
                        <span class="text-neutral-300 font-medium">${key}</span>
                        <span class="font-bold ${profits[key] >= 0 ? 'text-green-400' : 'text-red-400'}">${formatCurrency(profits[key])}</span>
                    `;
                    listElement.appendChild(li);
                });
                return true;
            };

            const hasData = renderList(dailyList, dailyProfits) || renderList(monthlyList, monthlyProfits) || renderList(annualList, annualProfits);
            if (!hasData) {
                noProfitDataMsg.classList.remove('hidden');
            } else {
                noProfitDataMsg.classList.add('hidden');
            }
        };

        // --- Inicialização ---
        const updateAll = () => {
            renderSummary();
            renderOpenBets();
            renderHistoryBets();
            renderPeople();
            renderUnusedFreebets();
            renderProfitAnalysis();
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log("Usuário logado:", user.email);
                authContainer.style.display = 'none';
                mainContent.style.display = 'block';
                loadBets();
                loadPeople();
                loadFreebets();
                updateAll();
            } else {
                // Usuário não está logado
                authContainer.style.display = 'block';
                mainContent.style.display = 'none';
                console.log("Nenhum usuário logado.");
            }
        });

</script>
</body>
</html>